Name: Chromium Browser Notifications
Author: Maxime Thiebaut (@0xThiebaut)
Categories:
  - Chrome
  - Edge
  - Browser

FilenameRegex: "Preferences"
Globs:
  - "{{LinuxChromeProfiles}}/*/Preferences"
  - "{{WindowsChromeProfiles}}/*/Preferences"
  - "{{MacOSChromeProfiles}}/*/Preferences"

Sources:
- name: Notification Preferences
  VQL: |
    LET ContentSettings <= array(`0`="Default",`1`="Allow",`2`="Block",`3`="Ask",`4`="Session Only",`5`="Detect Important Content")
    LET Notifications <= SELECT * FROM foreach(
      row={SELECT OSPath FROM Rows},
      query={
        SELECT profile.content_settings.exceptions.notifications AS Notifications, OSPath
        FROM parse_jsonl(filename=OSPath)
      })
    SELECT * FROM foreach(
      row=Notifications,
      query={
        SELECT
          _key as URL,
          timestamp(winfiletime=(int(int=_value.last_modified)*10)) as LastModified,
          ContentSettings[_value.setting] AS Setting,
          OSPath
        FROM items(item=Notifications)
      })
    
- name: Notification Interactions
  VQL: |
    LET Notifications <= SELECT * FROM foreach(
      row={SELECT OSPath FROM Rows},
      query={
        SELECT profile.content_settings.exceptions.notification_interactions AS Interactions, OSPath
        FROM parse_jsonl(filename=OSPath)
      })
    LET Interactions <= SELECT * FROM foreach(
      row=Notifications,
      query={
        SELECT
          _key as URL,
          timestamp(winfiletime=(int(int=_value.last_modified)*10)) as LastModified,
          _value.setting AS Setting,
          OSPath
        FROM items(item=Interactions)
      })
    SELECT * FROM foreach(
      row=Interactions,
      query={
        SELECT
          URL, 
          LastModified,
          timestamp(epoch=_key) as Date,
          _value.display_count as DisplayCount,
          _value.click_count as ClickCount,
          OSPath
        FROM items(item=Setting)
      })
